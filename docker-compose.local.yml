services:
  postgres:
    ports:
      - "${POSTGRES_PORT}:5432"

  redis:
    ports:
      - "${REDIS_PORT}:6379"

  api:
    ports:
      - "${API_PORT}:${API_INTERNAL_PORT}"

  web:
    image: node:20-bookworm-slim
    working_dir: /workspace/web
    command: sh -c "npm ci && npm run dev -- --hostname 0.0.0.0 --port ${WEB_INTERNAL_PORT}"
    volumes:
      - ./web:/workspace/web
      - web_node_modules:/workspace/web/node_modules
    ports:
      - "${WEB_PORT}:${WEB_INTERNAL_PORT}"
    environment:
      NEXT_PUBLIC_API_BASE_URL: http://localhost:${API_PORT}
      NEXT_PUBLIC_ENABLE_MANUAL_TOKEN: ${NEXT_PUBLIC_ENABLE_MANUAL_TOKEN}
      HOSTNAME: 0.0.0.0
      PORT: ${WEB_INTERNAL_PORT}

volumes:
  web_node_modules:
